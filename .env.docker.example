# ==============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ==============================================================================
# This file contains PRODUCTION environment variables for Docker deployment.
# Copy this file to .env and fill in secure values.
# 
# ⚠️  SECURITY WARNINGS:
# 1. NEVER commit .env to version control!
# 2. Set file permissions: chmod 600 .env
# 3. Generate strong random secrets (see below)
# 4. Rotate secrets every 90 days
# 5. Use different secrets for each environment
#
# Generate secure secrets:
#   DB_PASSWORD:  openssl rand -base64 24
#   JWT_SECRET:   openssl rand -base64 32
#
# For more security information, see: DOCKER_SECURITY.md
# ==============================================================================

# ==============================================================================
# ENVIRONMENT MODE
# ==============================================================================
# NODE_ENV determines application behavior and security settings
# 
# Available modes:
#   development - Local dev with hot reload, verbose logging, relaxed security
#                 • Rate limiting: DISABLED
#                 • Error details: FULL stack traces shown
#                 • CSP: Report-only mode
#                 • Auto-generates admin user
#   
#   test        - Used by automated test suites (npm test)
#                 • Uses separate test database (shotspot_test_db)
#                 • Mocks external services
#                 • No rate limiting
#                 • Minimal logging
#   
#   production  - Optimized for deployment with maximum security
#                 • Rate limiting: ENABLED (1000 req/5min)
#                 • Error details: GENERIC messages only
#                 • CSP: Enforcing mode
#                 • HTTPS required for secure cookies
#                 • All security variables mandatory
# 
# ⚠️  IMPORTANT: Use 'production' for Docker deployment
NODE_ENV=production

# ==============================================================================
# VITE FRONTEND MODE
# ==============================================================================
# VITE_NODE_ENV affects frontend build optimization and error handling
# 
# Note: Vite automatically sets this based on the command:
#   npm run dev     → development
#   npm run build   → production
# 
# Only set manually if you need to override Vite's defaults
# VITE_NODE_ENV=production

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
PORT=3001

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================
# ⚠️  CRITICAL: Change these credentials before deploying!
# Generate with: openssl rand -base64 24
DB_HOST=db
DB_PORT=5432
DB_NAME=shotspot_db
DB_USER=shotspot_user
DB_PASSWORD=CHANGE_THIS_SECURE_PASSWORD_MINIMUM_24_CHARS
DB_SSL=false

# Connection pool settings
DB_MAX_CONNECTIONS=20
DB_IDLE_TIMEOUT_MS=30000

# Database Superuser (for initial setup only)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=CHANGE_THIS_POSTGRES_PASSWORD

# ==============================================================================
# SECURITY & AUTHENTICATION
# ==============================================================================
# ⚠️  CRITICAL: Generate a strong random JWT secret!
# Generate with: openssl rand -base64 32
# Requirements:
#   - Minimum 32 characters
#   - Use different secret for each environment
#   - Never share or commit to version control
#   - Rotate every 90 days
JWT_SECRET=CHANGE_THIS_MINIMUM_32_CHARS_RANDOM_STRING_GENERATE_WITH_OPENSSL
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d
SESSION_SECRET=CHANGE_THIS_SESSION_SECRET_GENERATE_WITH_OPENSSL
CSRF_SECRET=CHANGE_THIS_CSRF_SECRET_GENERATE_WITH_OPENSSL

# Session/Cookie Configuration (CRITICAL for Docker)
# ⚠️  IMPORTANT: These settings fix CSRF token issues in Docker
# Set SESSION_SECURE=false when running without HTTPS (Docker default)
# Set SESSION_SECURE=true only if using HTTPS with valid certificates
SESSION_SECURE=false
SESSION_SAME_SITE=lax
COOKIE_DOMAIN=
# Leave COOKIE_DOMAIN empty for Docker - browser will handle domain automatically

# Default Admin User (created automatically on first startup)
DEFAULT_ADMIN_USERNAME=admin
DEFAULT_ADMIN_EMAIL=admin@shotspot.local
# Leave empty to auto-generate a secure password (will be shown in logs once)
DEFAULT_ADMIN_PASSWORD=

# CORS Configuration
# ⚠️  Set to your actual domain in production!
# Examples:
#   Development:  http://localhost:3000
#   Production:   https://shotspot.example.com
#   Multiple:     https://shotspot.example.com,https://app.shotspot.example.com
CORS_ORIGIN=http://localhost:3000

# ==============================================================================
# RATE LIMITING
# ==============================================================================
# Rate limit window in milliseconds (5 minutes = 300000ms)
RATE_LIMIT_WINDOW_MS=300000
# Maximum requests per window
RATE_LIMIT_MAX=1000

# Advanced Rate Limiting
# Trusted IPs bypass rate limiting (comma-separated)
# TRUSTED_IPS=127.0.0.1,10.0.0.1
# RATE_LIMIT_SKIP_TRUSTED=true

# API Configuration
API_MAX_PAYLOAD_SIZE=10kb

# ==============================================================================
# LOGGING
# ==============================================================================
# Options: error, warn, info, debug
LOG_LEVEL=info
# Options: combined, common, dev, short, tiny
LOG_FORMAT=combined

# Log file configuration
# LOG_FILE_PATH=logs/app.log
# ENABLE_REQUEST_LOGGING=true
# ENABLE_ERROR_LOGGING=true
# ENABLE_SECURITY_LOGGING=true

# ==============================================================================
# SECURITY HEADERS
# ==============================================================================
# HTTP Strict Transport Security (HSTS)
# ENABLE_HSTS=true
# HSTS_MAX_AGE=31536000

# Content Security Policy (CSP)
# CSP_REPORT_URI=http://localhost:3001/api/csp-report

# ==============================================================================
# ERROR NOTIFICATIONS (Optional)
# ==============================================================================
# Enable webhook notifications for critical errors
ENABLE_ERROR_NOTIFICATIONS=false

# Webhook URLs (leave empty if not using)
ERROR_NOTIFICATION_WEBHOOK=

# Email notifications
# ERROR_NOTIFICATION_EMAIL=admin@example.com
# ERROR_EMAIL_FROM=errors@shotspot.app

# Slack integration
SLACK_WEBHOOK_URL=

# Microsoft Teams integration
TEAMS_WEBHOOK_URL=

# Log viewer URL (for notification links)
# LOG_VIEWER_URL=http://localhost:3001

# ==============================================================================
# FRONTEND CONFIGURATION
# ==============================================================================
# API URL for frontend (used during build)
VITE_API_URL=http://localhost:3001/api
